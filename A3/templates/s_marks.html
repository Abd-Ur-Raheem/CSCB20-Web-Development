<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/headfoot.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/s_marks.css') }}">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marks</title>
</head>
<body>
    <div class="contents">
        <div class="icon"><h2>CSCB20</h2></div>
        <ul>
            <li><a href="{{ url_for('home') }}">Home</a></li>
            <li><a href="{{ url_for('syllabus') }}">Syllabus</a></li>
            <li><a href="{{ url_for('assignments') }}">Assignments</a></li>
            <li><a href="{{ url_for('labs') }}">Labs</a></li>
            <li><a href="{{ url_for('lecture') }}">Lecture Notes</a></li>
            <li><a href="https://piazza.com/class/lzu0yiltalh4fi">Piazza</a></li>
            <li><a href="https://markus2.utsc.utoronto.ca/?locale=en">Markus</a></li>
            <li><a href="{{ url_for('anon') }}">Anon Feedback</a></li>
            <li><a href="{{ url_for('team') }}">Course Team</a></li>
            <li><a href="{{ url_for('view_feedback') }}">Student Feedback</a></li>
            <li><a href="{{ url_for('s_marks') }}">Marks</a></li>
            <li><a href="{{ url_for('logout') }}">Logout</a></li>
        </ul>
    </div>

    <h1 class="h">Welcome {{ student_name }}, here are your current grades:</h1>
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="flash-{{ category }}">{{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}
    <div class="box">
        <div class="mark-type"><h3>Assignments</h3></div>
        <table class="assignment-table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Due Date</th>
                    <th>Grade</th>
                    <th>Remark Request</th>
                    <th>Remark Status</th>
                </tr>
            </thead>
            <tbody>
                {% for mark in marks if 'A' in mark.assignment_name %}
                <tr>
                    <td>{{ mark.assignment_name }}</td>
                    <td>{{ mark.due_date }}</td>
                    <td>{{ mark.grade if mark.grade else 'Not graded' }}/100</td>
                    <td class="remark">
                        {% if mark.remark_request %}
                            <p>Request: {{ mark.remark_request }}</p>
                        {% else %}
                            <form method="POST" action="{{ url_for('submit_remark') }}">
                                <input type="hidden" name="mark_id" value="{{ mark.id }}">
                                <input type="text" class="input-field" name="remark_text" placeholder="Reason for remark" autocomplete="off" required>
                                <button type="submit">Submit Remark</button>
                            </form>
                        {% endif %}
                    </td>
                    <td>{{ mark.remark_status }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <div class="tut-box">
            <div class="mark-type"><h3>Tutorial Work</h3></div>
            <table class="assignment-table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Due Date</th>
                        <th>Grade</th>
                        <th>Remark Request</th>
                        <th>Remark Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for mark in marks if 'Week' in mark.assignment_name %}
                    <tr>
                        <td>{{ mark.assignment_name }}</td>
                        <td>{{ mark.due_date }}</td>
                        <td>{{ mark.grade if mark.grade else 'Not graded' }}/100</td>
                        <td class="remark">
                            {% if mark.remark_request %}
                                <p>Request: {{ mark.remark_request }}</p>
                            {% else %}
                                <form method="POST" action="{{ url_for('submit_remark') }}">
                                    <input type="hidden" name="mark_id" value="{{ mark.id }}">
                                    <input type="text" class="input-field" name="remark_text" placeholder="Reason for remark" autocomplete="off" required>
                                    <button type="submit">Submit Remark</button>
                                </form>
                            {% endif %}
                        </td>
                        <td>{{ mark.remark_status }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="mark-type"><h3>Exams</h3></div>
        <table class="assignment-table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Date</th>
                    <th>Grade</th>
                    <th>Remark Request</th>
                    <th>Remark Status</th>
                </tr>
            </thead>
            <tbody>
                {% for mark in marks if 'Exam' in mark.assignment_name or 'Midterm' in mark.assignment_name %}
                <tr>
                    <td>{{ mark.assignment_name }}</td>
                    <td>{{ mark.due_date }}</td>
                    <td>{{ mark.grade if mark.grade else 'Not graded' }}/100</td>
                    <td class="remark">
                        {% if mark.remark_request %}
                            <p>Request: {{ mark.remark_request }}</p>
                        {% else %}
                            <form method="POST" action="{{ url_for('submit_remark') }}">
                                <input type="hidden" name="mark_id" value="{{ mark.id }}">
                                <input type="text" class="input-field" name="remark_text" placeholder="Reason for remark" autocomplete="off" required>
                                <button type="submit">Submit Remark</button>
                            </form>
                        {% endif %}
                    </td>
                    <td>{{ mark.remark_status }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="footer-section">
        <div class="footer">
            <div class="footer-title">
                <h1 class="b20">CSCB20</h1>
                <h1 class="name">Intro to Databases & Web Apps</h1>
            </div>
            <div><h3>Designed by Tahmeed Rahman</h3></div>
        </div>
        <div class="footer">
            <div><h3>For more information visit:</h3></div>
            <a href="https://web.cs.toronto.edu/" target="_blank">Department of Computer Science at UofT</a>
        </div>
    </div>
</body>
</html>